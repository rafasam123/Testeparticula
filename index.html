<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Sketch com Notas e Controles</title>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.9.0/lib/p5.min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: monospace, monospace;
      background: #f0f0f0;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px;
    }

    /* Abas */
    .tabs {
      display: flex;
      margin-bottom: 10px;
      cursor: pointer;
      user-select: none;
    }
    .tab {
      background: #ddd;
      padding: 8px 16px;
      border: 1px solid #aaa;
      border-bottom: none;
      margin-right: 3px;
      border-radius: 5px 5px 0 0;
      font-weight: bold;
    }
    .tab.active {
      background: white;
      border-bottom: 1px solid white;
    }

    /* Conte√∫do das notas */
    .note-content {
      width: 90vw;
      max-width: 1280px;
      height: 250px;
      border: 1px solid #aaa;
      background: white;
      overflow: auto;
      padding: 10px;
      white-space: pre-wrap;
      font-size: 14px;
      line-height: 1.3em;
      display: none;
    }
    .note-content.active {
      display: block;
    }

    /* Canvas e controles */
    #sketch-holder {
      border: 1px solid #aaa;
      margin-top: 20px;
      width: 700px;
      height: 400px;
      background: white;
    }

    .controls {
      margin-top: 15px;
    }
    button {
      margin: 0 5px;
      padding: 8px 16px;
      font-size: 14px;
      cursor: pointer;
      border-radius: 5px;
      border: 1px solid #888;
      background: #eee;
      transition: background 0.3s;
    }
    button:hover {
      background: #ddd;
    }
  </style>
</head>
<body>

  <h2>Sketch p5.js com Notas e Controles</h2>

  <div class="tabs">
    <div class="tab active" data-tab="note1">Nota 1</div>
    <div class="tab" data-tab="note2">Nota 2</div>
    <div class="tab" data-tab="note3">Nota 3</div>
  </div>

  <pre id="note1" class="note-content active">
// The Nature of Code
// Daniel Shiffman
// http://natureofcode.com

class Emitter {
  constructor(x, y) {
    this.origin = createVector(x, y);
    this.particles = [];
  }

  addParticle() {
    this.particles.push(new Particle(this.origin.x, this.origin.y));
  }

  run() {
    // Looping through backwards to delete
    for (let i = this.particles.length - 1; i >= 0; i--) {
      this.particles[i].run();
      if (this.particles[i].isDead()) {
        // Remove the particle
        this.particles.splice(i, 1);
      }
    }

    // Run every particle
    // ES6 for..of loop
    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/for...of
    // https://www.youtube.com/watch?v=Y8sMnRQYr3c
    // for (let particle of this.particles) {
    //   particle.run();
    // }

    // Filter removes any elements of the array that do not pass the test
    // I am also using ES6 arrow snytax
    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions
    // https://www.youtube.com/watch?v=mrYMzpbFz18
    // this.particles = this.particles.filter(particle => !particle.isDead());

    // Without ES6 arrow code would look like:
    // this.particles = this.particles.filter(function(particle) {
    //   return !particle.isDead();
    // });
  }
}
  </pre>

  <pre id="note2" class="note-content">
// The Nature of Code
// Daniel Shiffman
// http://natureofcode.com

let emitter;

function setup() {
  createCanvas(1280, 480);
  emitter = new Emitter(width / 3, 50);
}

function draw() {
  background(255,30);

  // Apply gravity force to all Particles
  let gravity = createVector(0, 0.1);
  emitter.applyForce(gravity);

  emitter.addParticle();
  emitter.run();
}
  </pre>

  <pre id="note3" class="note-content">
// One ParticleSystem
let emitter;

//{!1} One repeller
let repeller;

function setup() {
  createCanvas(640 , 240);
  emitter = new Emitter(width / 2, 60);
  repeller = new Repeller(width / 2, 160);
}

function draw() {
  background(255);
  emitter.addParticle();
  // We‚Äôre applying a universal gravity.
  let gravity = createVector(0, 0.1);
  emitter.applyForce(gravity);
  //{!1} Applying the repeller
  emitter.applyRepeller(repeller);
  emitter.run();

  repeller.show();
}
  </pre>

  <div class="controls">
    <button onclick="startSketch()">‚ñ∂Ô∏è Play</button>
    <button onclick="pauseSketch()">‚è∏Ô∏è Pause</button>
    <button onclick="resetSketch()">üîÅ Reset</button>
  </div>

  <div id="sketch-holder"></div>

  <script>
    // Controle das abas
    const tabs = document.querySelectorAll('.tab');
    const notes = document.querySelectorAll('.note-content');

    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        const target = tab.dataset.tab;
        tabs.forEach(t => t.classList.remove('active'));
        notes.forEach(n => n.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(target).classList.add('active');
      });
    });

    // Sketch p5.js instanciado em modo instance para controle

    let sketch = function(p) {
      class Particle {
        constructor(x, y) {
          this.pos = p.createVector(x, y);
          this.vel = p.createVector(p.random(-1, 1), p.random(-2, 0));
          this.acc = p.createVector(0, 0);
          this.lifespan = 255;
        }
        run() {
          this.update();
          this.display();
        }
        applyForce(force) {
          this.acc.add(force);
        }
        update() {
          this.vel.add(this.acc);
          this.pos.add(this.vel);
          this.acc.mult(0);
          this.lifespan -= 4;
        }
        display() {
          p.noStroke();
          p.fill(127, this.lifespan);
          p.ellipse(this.pos.x, this.pos.y, 12);
        }
        isDead() {
          return this.lifespan < 0;
        }
      }

      class Emitter {
        constructor(x, y) {
          this.origin = p.createVector(x, y);
          this.particles = [];
        }
        addParticle() {
          this.particles.push(new Particle(this.origin.x, this.origin.y));
        }
        run() {
          for (let i = this.particles.length - 1; i >= 0; i--) {
            this.particles[i].run();
            if (this.particles[i].isDead()) {
              this.particles.splice(i, 1);
            }
          }
        }
        applyForce(force) {
          for (let particle of this.particles) {
            particle.applyForce(force);
          }
        }
      }

      class Repeller {
        constructor(x, y) {
          this.pos = p.createVector(x, y);
          this.radius = 20;
        }
        show() {
          p.stroke(255, 0, 0);
          p.strokeWeight(2);
          p.noFill();
          p.ellipse(this.pos.x, this.pos.y, this.radius * 2);
        }
      }

      let emitter;
      let repeller;
      let paused = false;

      p.setup = function() {
        let canvas = p.createCanvas(700, 400);
        canvas.parent('sketch-holder');
        emitter = new Emitter(p.width / 2, 60);
        repeller = new Repeller(p.width / 2, 160);
        paused = false;
      };

      p.draw = function() {
        if (!paused) {
          p.background(255);
          emitter.addParticle();
          let gravity = p.createVector(0, 0.1);
          emitter.applyForce(gravity);
          emitter.run();
          repeller.show();
        }
      };

      p.startSketch = function() {
        paused = false;
        p.loop();
      };

      p.pauseSketch = function() {
        paused = true;
        p.noLoop();
      };

      p.resetSketch = function() {
        emitter.particles = [];
        paused = false;
        p.loop();
      };

      // Expor para escopo global para controlar pelos bot√µes
      window.startSketch = p.startSketch;
      window.pauseSketch = p.pauseSketch;
      window.resetSketch = p.resetSketch;
    };

    new p5(sketch);
  </script>

</body>
</html>
